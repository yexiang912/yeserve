#!/bin/bash

# Ubuntu软件源一键切换脚本
# yx原创

# 颜色定义
RED='\033[0;31m'
GREEN='\033[0;32m'
YELLOW='\033[1;33m'
NC='\033[0m'

show_menu() {
    clear
    echo "================================="
    echo "    Ubuntu软件源切换工具"
    echo "          (yx原创)"
    echo "================================="
    echo "1. 清华大学源"
    echo "2. 阿里云源"
    echo "3. 华为云源"
    echo "4. 中科大源"
    echo "5. 恢复官方源"
    echo "6. 查看当前源"
    echo "0. 退出"
    echo "================================="
}

backup_sources() {
    if [ ! -f /etc/apt/sources.list.bak ]; then
        cp /etc/apt/sources.list /etc/apt/sources.list.bak
        echo -e "${GREEN}已备份当前源文件${NC}"
    fi
}

set_tsinghua_source() {
    cat > /etc/apt/sources.list << TSINGHUA_EOF
# 清华大学源
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
deb https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-security main restricted universe multiverse
# deb-src https://mirrors.tuna.tsinghua.edu.cn/ubuntu/ noble-security main restricted universe multiverse
TSINGHUA_EOF
}

set_aliyun_source() {
    cat > /etc/apt/sources.list << ALIYUN_EOF
# 阿里云源
deb https://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ noble-security main restricted universe multiverse
deb https://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.aliyun.com/ubuntu/ noble-proposed main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ noble-proposed main restricted universe multiverse
deb https://mirrors.aliyun.com/ubuntu/ noble-backports main restricted universe multiverse
deb-src https://mirrors.aliyun.com/ubuntu/ noble-backports main restricted universe multiverse
ALIYUN_EOF
}

set_huawei_source() {
    cat > /etc/apt/sources.list << HUAWEI_EOF
# 华为云源
deb https://repo.huaweicloud.com/ubuntu/ noble main restricted universe multiverse
deb-src https://repo.huaweicloud.com/ubuntu/ noble main restricted universe multiverse
deb https://repo.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse
deb-src https://repo.huaweicloud.com/ubuntu/ noble-security main restricted universe multiverse
deb https://repo.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse
deb-src https://repo.huaweicloud.com/ubuntu/ noble-updates main restricted universe multiverse
deb https://repo.huaweicloud.com/ubuntu/ noble-proposed main restricted universe multiverse
deb-src https://repo.huaweicloud.com/ubuntu/ noble-proposed main restricted universe multiverse
deb https://repo.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse
deb-src https://repo.huaweicloud.com/ubuntu/ noble-backports main restricted universe multiverse
HUAWEI_EOF
}

set_ustc_source() {
    cat > /etc/apt/sources.list << USTC_EOF
# 中科大源
deb https://mirrors.ustc.edu.cn/ubuntu/ noble main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ noble main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-security main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ noble-security main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ noble-updates main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-proposed main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ noble-proposed main restricted universe multiverse
deb https://mirrors.ustc.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
deb-src https://mirrors.ustc.edu.cn/ubuntu/ noble-backports main restricted universe multiverse
USTC_EOF
}

restore_official_source() {
    if [ -f /etc/apt/sources.list.bak ]; then
        cp /etc/apt/sources.list.bak /etc/apt/sources.list
        echo -e "${GREEN}已恢复官方源${NC}"
    else
        cat > /etc/apt/sources.list << OFFICIAL_EOF
# 官方源
deb http://archive.ubuntu.com/ubuntu/ noble main restricted universe multiverse
deb-src http://archive.ubuntu.com/ubuntu/ noble main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu/ noble-security main restricted universe multiverse
deb-src http://archive.ubuntu.com/ubuntu/ noble-security main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu/ noble-updates main restricted universe multiverse
deb-src http://archive.ubuntu.com/ubuntu/ noble-updates main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu/ noble-proposed main restricted universe multiverse
deb-src http://archive.ubuntu.com/ubuntu/ noble-proposed main restricted universe multiverse
deb http://archive.ubuntu.com/ubuntu/ noble-backports main restricted universe multiverse
deb-src http://archive.ubuntu.com/ubuntu/ noble-backports main restricted universe multiverse
OFFICIAL_EOF
    fi
}

show_current_source() {
    echo -e "${YELLOW}当前使用的软件源：${NC}"
    echo "---------------------------------"
    head -15 /etc/apt/sources.list
    echo "---------------------------------"
}

# 检查是否为root用户
if [[ $EUID -ne 0 ]]; then
    echo -e "${RED}请使用root用户运行此脚本！${NC}"
    exit 1
fi

# 主程序
main() {
    while true; do
        show_menu
        read -p "请选择操作 (0-6): " choice
        
        case $choice in
            1)
                backup_sources
                set_tsinghua_source
                echo -e "${GREEN}已切换为清华大学源${NC}"
                ;;
            2)
                backup_sources
                set_aliyun_source
                echo -e "${GREEN}已切换为阿里云源${NC}"
                ;;
            3)
                backup_sources
                set_huawei_source
                echo -e "${GREEN}已切换为华为云源${NC}"
                ;;
            4)
                backup_sources
                set_ustc_source
                echo -e "${GREEN}已切换为中科大源${NC}"
                ;;
            5)
                restore_official_source
                ;;
            6)
                show_current_source
                ;;
            0)
                echo "退出脚本"
                exit 0
                ;;
            *)
                echo -e "${RED}无效选择，请重新输入${NC}"
                sleep 1
                continue
                ;;
        esac
        
        if [[ $choice -ge 1 && $choice -le 5 ]]; then
            read -p "是否立即更新软件包列表？(y/n): " update_choice
            if [[ $update_choice == "y" || $update_choice == "Y" ]]; then
                apt-get update
            fi
        fi
        
        echo ""
        read -p "按回车键继续..."
    done
}

main